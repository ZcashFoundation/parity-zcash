language: rust

rust: stable

branches:
  only:
  - master

cache:
  directories:
  - "$HOME/.rustup"
  - "$HOME/.cargo"

matrix:
  fast_finish: true

  allow_failures:
    - rust: nightly-2019-06-30

  include:
    - rust: nightly-2019-06-30
      before_script: rustup component add rustfmt-preview
      script: cargo fmt --all -- --check

jobs:
  include:
    - stage: cargo fetch
      script: cargo fetch --verbose
    - stage: test and build
      script: cargo test --all
    - stage: test and build
      script: cargo build --release --all
